# ============================================================
# VellumFE Configuration
# ============================================================
# This file controls client behavior. Most users only need to
# modify [connection] and [ui] sections.
#
# Configuration files (in ~/.vellum-fe/ or per-character folder):
#   config.toml     - This file (connection, UI, sound settings)
#   keybinds.toml   - Keyboard shortcuts
#   highlights.toml - Text highlighting and coloring rules
#   colors.toml     - Color palette definitions
#   layout.toml     - Window positions and sizes
#
# Use .reload command in-game to apply changes without restart.
# ============================================================


# ------------------------------------------------------------
# CONNECTION
# ------------------------------------------------------------
# Where to connect. Default is Lich proxy on localhost.
#
# For direct connection (without Lich), use: vellum-fe --direct
# Credentials can be stored here or passed via CLI (CLI overrides config).

[connection]
host = "127.0.0.1"
port = 8001
# character = "YourName"  # Character for Lich proxy and direct connect login

# --- Direct Connection (all optional) ---
# Store credentials here to simplify direct connection:
#   vellum-fe --direct --character YourChar
#
# CLI arguments (--account, --password, --game) override these values.
# If password is not set, you will be prompted securely at startup.
#
# account = "your_account"
# password = "your_password"  # OPTIONAL - stored in PLAIN TEXT, use CLI for security
# game = "prime"
#   GemStone IV: "prime", "platinum", "shattered", "test"
#   DragonRealms: "dr", "drplatinum", "drfallen", "drtest"


# ------------------------------------------------------------
# USER INTERFACE
# ------------------------------------------------------------
# Display and interaction settings.

[ui]
# --- Window Defaults ---
# These values apply to windows that don't specify their own settings.

# Default text buffer size (lines kept in memory per window)
buffer_size = 1000

# Default window border style: "single", "double", "rounded", "thick", "none"
border_style = "single"

# Icon for countdown timer blocks (uses Nerd Font glyph)
# Examples: "" (square), "" (circle), "‚óè" (bullet)
# Find icons: https://www.nerdfonts.com/cheat-sheet
countdown_icon = ""

# Color rendering mode - choose based on your terminal:
#
#   "direct"  - 24-bit true color (16 million colors)
#               Use with: kitty, alacritty, wezterm, iTerm2, Windows Terminal
#
#   "slot"    - 256-color with custom palette via .setpalette
#               Use with: terminals supporting OSC4 palette reprogramming
#               Allows exact color matching via terminal palette slots
#
#   "indexed" - 256-color with standard xterm palette (finds closest match)
#               Use with: legacy terminals, SSH sessions, or when colors look wrong
#               Safe fallback that works everywhere
#
color_mode = "direct"

# --- Text Selection ---
selection_enabled = true
selection_respect_window_boundaries = true
selection_auto_copy = true  # Copy to clipboard on mouse-up

# --- Drag and Drop ---
# Modifier key required for window dragging: "ctrl", "alt", "shift"
drag_modifier_key = "ctrl"

# --- Command History ---
# Minimum command length to save (shorter commands not recorded)
min_command_length = 3

# --- Performance Overlay (Debug) ---
# Press F3 or use .perf command to toggle
performance_stats_enabled = false
perf_stats_x = 0
perf_stats_y = 0
perf_stats_width = 35
perf_stats_height = 23


# ------------------------------------------------------------
# HIGHLIGHT SYSTEM
# ------------------------------------------------------------
# Global toggles for highlight features (disable without deleting patterns).
# Note: System highlights (monsterbold, links, roomname) are NOT affected.

[highlights]
ignores_enabled = true      # Squelch/hide matching lines
sounds_enabled = true       # Play sounds on pattern match
replace_enabled = true      # Apply text replacements
redirect_enabled = true     # Route lines to other windows
coloring_enabled = true     # Apply color highlighting


# ------------------------------------------------------------
# SOUND
# ------------------------------------------------------------
# Audio feedback and startup music.
# Set enabled = false to skip audio initialization entirely.

[sound]
enabled = true
volume = 0.7           # Master volume (0.0 to 1.0)
cooldown_ms = 500      # Minimum time between repeated sounds
startup_music = true   # Play music on connection
startup_music_file = "wizard_music"  # Sound file (without extension)


# ------------------------------------------------------------
# TEXT-TO-SPEECH (Accessibility)
# ------------------------------------------------------------
# Screen reader support via native TTS engines.
# TTS operates independently of the sound system above.
# Controls: Ctrl+Shift+N (next), Ctrl+Shift+P (previous),
#           Ctrl+Shift+M (mute toggle)

[tts]
enabled = false        # Set to true to enable TTS
rate = 1.0             # Speech rate: 0.5 (slow) to 2.0 (fast)
volume = 1.0           # Volume: 0.0 (silent) to 1.0 (full)
speak_thoughts = true  # Speak focused thoughts
speak_speech = true    # Speak speech window
speak_main = false     # Speak main window (can be overwhelming)


# ------------------------------------------------------------
# STREAM ROUTING
# ------------------------------------------------------------
# Controls how text streams are handled when no widget subscribes.
# Most users won't need to modify this section.

[streams]
# Streams to silently discard if no widget subscribes to them.
#
# Communication streams (speech, whisper, talk, conversation):
#   The game sends speech content twice - once to main stream (full context like
#   "You say, 'hello'") and once to the dedicated stream. Drop these to prevent
#   duplication when no speech window exists.
#
# Script streams (targetcount, playercount, targetlist, playerlist):
#   Generated by Lich scripts like ;targetlist. Drop to prevent noise like "[ 0]"
#   in main window when no dedicated widget exists.
drop_unsubscribed = [
  "targetcount",
  "playercount",
  "targetlist",
  "playerlist",
  "speech",
  "whisper",
  "talk",
  "conversation"
]

# Where to route streams that aren't in the drop list.
# Default routes unknown streams to main window.
fallback = "main"


# ============================================================
# ADVANCED SETTINGS
# ============================================================
# Most users won't need to modify settings below this line.


# ------------------------------------------------------------
# EVENT PATTERNS
# ------------------------------------------------------------
# Regex patterns to detect game events for countdown timers.
# Each pattern can trigger stun/RT/CT timer updates.
#
# Fields:
#   pattern           - Regex to match game text
#   event_type        - Timer type: "stun", "rt", "ct"
#   action            - "set" (start timer) or "clear" (cancel timer)
#   duration          - Fixed duration in seconds (if not captured)
#   duration_capture  - Regex capture group for dynamic duration
#   duration_multiplier - Multiply captured value (e.g., 5.0 for rounds)
#   enabled           - Toggle pattern on/off

[event_patterns.stun_rounds]
pattern = '^\s*You are stunned for ([0-9]+) rounds?'
event_type = "stun"
action = "set"
duration = 0
duration_capture = 1
duration_multiplier = 5.0
enabled = true

[event_patterns.stun_recovery]
pattern = 'You recover from being stunned\.'
event_type = "stun"
action = "clear"
duration = 0
duration_multiplier = 1.0
enabled = true

[event_patterns.stun_raise_dead]
pattern = 'Your surroundings grow dim\.\.\.you lapse into a state of awareness only'
event_type = "stun"
action = "set"
duration = 31
duration_multiplier = 1.0
enabled = true

[event_patterns.stun_shadow_valley]
pattern = "Just as you think the falling will never end, you crash through an ethereal barrier"
event_type = "stun"
action = "set"
duration = 16
duration_multiplier = 1.0
enabled = true


# ------------------------------------------------------------
# LAYOUT MAPPINGS
# ------------------------------------------------------------
# Automatically switch layouts based on terminal size.
# Useful for responsive layouts on resize.
#
# Example:
# [[layout_mappings]]
# min_width = 80
# min_height = 24
# max_width = 120
# max_height = 40
# layout = "compact"
#
# [[layout_mappings]]
# min_width = 121
# min_height = 41
# max_width = 9999
# max_height = 9999
# layout = "fullscreen"

layout_mappings = []
