# ============================================================
# VellumFE Configuration
# ============================================================
# This file controls client behavior. Most users only need to
# modify [connection] and [ui] sections.
#
# Configuration files (in ~/.vellum-fe/ or per-character folder):
#   config.toml     - This file (connection, UI, sound settings)
#   keybinds.toml   - Keyboard shortcuts
#   highlights.toml - Text highlighting and coloring rules
#   colors.toml     - Color palette definitions
#   layout.toml     - Window positions and sizes
#
# Use .reload command in-game to apply changes without restart.
# ============================================================


# ------------------------------------------------------------
# CONNECTION
# ------------------------------------------------------------
# Where to connect. Default is Lich proxy on localhost.
#
# For direct connection (without Lich), use: vellum-fe --direct
# Credentials can be stored here or passed via CLI (CLI overrides config).

[connection]
host = "127.0.0.1"
port = 8001
# character = "YourName"  # Character for Lich proxy and direct connect login

# --- Direct Connection (all optional) ---
# Store credentials here to simplify direct connection:
#   vellum-fe --direct --character YourChar
#
# CLI arguments (--account, --password, --game) override these values.
# If password is not set, you will be prompted securely at startup.
#
# account = "your_account"
# password = "your_password"  # OPTIONAL - stored in PLAIN TEXT, use CLI for security
# game = "prime"
#   GemStone IV: "prime", "platinum", "shattered", "test"
#   DragonRealms: "dr", "drplatinum", "drfallen", "drtest"


# ------------------------------------------------------------
# RAW LOGGING (Debug)
# ------------------------------------------------------------
# Capture raw XML from the network layer (pre-parse). Useful for debugging
# parser issues or reproducing sessions without Lich logs.
# Works for both direct and Lich connections.
#
# Logs are written to the profile directory by default:
#   ~/.vellum-fe/profiles/<character>/logs/
# File names use start time: YYYY-MM-DD-HH-MM-SS.xml

[logging]
enabled = false
# dir = "logs"              # Relative to profile dir or absolute path
# buffer_lines = 200        # Lines to buffer before write
# flush_interval_ms = 2000  # Periodic flush interval
# max_lines_per_file = 30000 # Rotate file after this many lines
# timestamps = true         # Prefix each line with HH:MM:SS


# ------------------------------------------------------------
# USER INTERFACE
# ------------------------------------------------------------
# Display and interaction settings.

[ui]
# --- Window Defaults ---
# These values apply to windows that don't specify their own settings.

# Default text buffer size (lines kept in memory per window)
buffer_size = 1000

# Default window border style: "single", "double", "rounded", "thick", "none"
border_style = "single"

# Icon for countdown timer blocks (uses Nerd Font glyph)
# Examples: "█" (square), "⚪" (circle), "●" (bullet)
# Find icons: https://www.nerdfonts.com/cheat-sheet
countdown_icon = "█"

# Color rendering mode - choose based on your terminal:
#
#   "direct"  - 24-bit true color (16 million colors)
#               Use with: kitty, alacritty, wezterm, iTerm2, Windows Terminal
#
#   "slot"    - 256-color with custom palette via .setpalette
#               Use with: terminals supporting OSC4 palette reprogramming
#               Allows exact color matching via terminal palette slots
#
#   "indexed" - 256-color with standard xterm palette (finds closest match)
#               Use with: legacy terminals, SSH sessions, or when colors look wrong
#               Safe fallback that works everywhere
#
color_mode = "direct"

# --- Text Selection ---
selection_enabled = true
selection_respect_window_boundaries = true
selection_auto_copy = true  # Copy to clipboard on mouse-up

# --- Drag and Drop ---
# Modifier key required for window dragging: "ctrl", "alt", "shift"
drag_modifier_key = "ctrl"

# --- Command History ---
# Minimum command length to save (shorter commands not recorded)
min_command_length = 3
# Echo sent commands into the main window (prompt + command line)
command_echo = true

# Highlight color for active items in the Betrayer panel (leading "!" marker)
betrayer_active_color = "#ff4040"

# Prevent these openDialog windows from auto-opening (still parse their data).
open_dialog_blocklist = [
  "combat",
  "injuries",
  "stance",
  "befriend",
  "espMasterDialog",
  "espMasterData",
  "Buffs",
  "Debuffs",
  "Cooldowns",
  "Active Spells",
  "mapMaster",
  "encum",
  "minivitals",
  "expr",
]

# --- Focus Navigation ---
# Configure which windows are focusable via Tab and the optional cycle order.
# If order is empty, VellumFE uses layout order filtered by focusable types.
#
# [ui.focus]
# types = ["text", "tabbedtext", "quickbar", "targets", "players", "inventory", "spells"]
# exclude = ["bounty", "society"]
# order = ["main", "thoughts", "quickbar"]

# --- Performance Overlay (Debug) ---
# Press F3 or use .perf command to toggle
performance_stats_enabled = false
perf_stats_x = 0
perf_stats_y = 0
perf_stats_width = 35
perf_stats_height = 23


# ------------------------------------------------------------
# QUICKBARS (CUSTOM)
# ------------------------------------------------------------
# Define custom quickbars that send custom commands.
# IDs must be "quick" or start with "quick-".
#
# Example:
# [quickbars]
# default = "quick-custom"
#
# [[quickbars.custom]]
# id = "quick-custom"
# title = "Custom"
# entries = [
#   { type = "link", label = "look", command = "look" },
#   { type = "sep" },
#   { type = "link", label = "inventory", command = "inventory" }
# ]


# ------------------------------------------------------------
# TARGET LIST
# ------------------------------------------------------------
# Configuration for the targets widget.
# Controls how creature names and statuses are displayed.

[target_list]
# Status display position: "start" or "end"
#   "end"   - Display status after name (e.g., "muddy hog [frozen]")
#   "start" - Display status before name (e.g., "[frozen] muddy hog")
status_position = "end"

# Truncation mode for long creature names:
#   "full" - Use full creature name (may truncate if too long)
#   "noun" - Use short noun when name + status exceeds width (e.g., "hog [frozen]")
truncation_mode = "noun"

# Status abbreviations (3 characters max for maximum space savings)
# If a status is not in this list, it will be truncated to 3 chars
# Users can customize or remove abbreviations as needed
[target_list.status_abbrev]
stunned = "stu"
frozen = "frz"
dead = "ded"
sitting = "sit"
kneeling = "kne"
prone = "prn"
webbed = "web"
immobilized = "imm"
bleeding = "ble"
standing = "std"
sleeping = "slp"
poisoned = "poi"
diseased = "dis"
bound = "bnd"
calmed = "cal"

# Nouns to exclude from target list (non-creature objects)
excluded_nouns = ["arm", "coal"]


# ------------------------------------------------------------
# HIGHLIGHT SYSTEM
# ------------------------------------------------------------
# Global toggles for highlight features (disable without deleting patterns).
# Note: System highlights (monsterbold, links, roomname) are NOT affected.

[highlights]
sounds_enabled = true       # Play sounds on pattern match
replace_enabled = true      # Apply text replacements
redirect_enabled = true     # Route lines to other windows
coloring_enabled = true     # Apply color highlighting


# ------------------------------------------------------------
# SOUND
# ------------------------------------------------------------
# Audio feedback.
# Set enabled = false to skip audio initialization entirely.

[sound]
enabled = true
volume = 0.7           # Master volume (0.0 to 1.0)
cooldown_ms = 500      # Minimum time between repeated sounds


# ------------------------------------------------------------
# TEXT-TO-SPEECH (Accessibility)
# ------------------------------------------------------------
# Screen reader support via native TTS engines.
# TTS operates independently of the sound system above.
# Controls: Ctrl+Shift+N (next), Ctrl+Shift+P (previous),
#           Ctrl+Shift+M (mute toggle)

[tts]
enabled = false        # Set to true to enable TTS
rate = 1.0             # Speech rate: 0.5 (slow) to 2.0 (fast)
volume = 1.0           # Volume: 0.0 (silent) to 1.0 (full)
speak_thoughts = true  # Speak focused thoughts
speak_speech = true    # Speak speech window
speak_main = false     # Speak main window (can be overwhelming)


# ------------------------------------------------------------
# STREAM ROUTING
# ------------------------------------------------------------
# Controls how text streams are handled when no widget subscribes.
# Most users won't need to modify this section.

[streams]
# Streams to silently discard if no widget subscribes to them.
#
# Communication streams (speech, whisper, talk, conversation):
#   The game sends speech content twice - once to main stream (full context like
#   "You say, 'hello'") and once to the dedicated stream. Drop these to prevent
#   duplication when no speech window exists.
#
# Script streams (targetcount, playercount, targetlist, playerlist):
#   Generated by Lich scripts like ;targetlist. Drop to prevent noise like "[ 0]"
#   in main window when no dedicated widget exists.
drop_unsubscribed = [
  "targetcount",
  "playercount",
  "targetlist",
  "playerlist",
  "speech",
  "whisper",
  "talk",
  "conversation"
]

# Where to route streams that aren't in the drop list.
# Default routes unknown streams to main window.
fallback = "main"

# Room text routing behavior (DragonRealms only - GemStone IV doesn't use streamWindow room).
# When true (default): Room text (name, description, exits) appears in main window.
#   The <streamWindow id='room'> tag does NOT change the active stream.
#   This is correct because the room window displays components, not text.
# When false: Legacy behavior where <streamWindow id='room'> pushes the stream,
#   causing room text to be discarded (since room window uses components only).
room_in_main = true


# ============================================================
# ADVANCED SETTINGS
# ============================================================
# Most users won't need to modify settings below this line.


# ------------------------------------------------------------
# EVENT PATTERNS
# ------------------------------------------------------------
# Regex patterns to detect game events for countdown timers.
# Each pattern can trigger stun/RT/CT timer updates.
#
# Fields:
#   pattern           - Regex to match game text
#   event_type        - Timer type: "stun", "rt", "ct"
#   action            - "set" (start timer) or "clear" (cancel timer)
#   duration          - Fixed duration in seconds (if not captured)
#   duration_capture  - Regex capture group for dynamic duration
#   duration_multiplier - Multiply captured value (e.g., 5.0 for rounds)
#   enabled           - Toggle pattern on/off

[event_patterns.stun_rounds]
pattern = '^\s*You are stunned for ([0-9]+) rounds?'
event_type = "stun"
action = "set"
duration = 0
duration_capture = 1
duration_multiplier = 5.0
enabled = true

[event_patterns.stun_recovery]
pattern = 'You recover from being stunned\.'
event_type = "stun"
action = "clear"
duration = 0
duration_multiplier = 1.0
enabled = true

[event_patterns.stun_raise_dead]
pattern = 'Your surroundings grow dim\.\.\.you lapse into a state of awareness only'
event_type = "stun"
action = "set"
duration = 31
duration_multiplier = 1.0
enabled = true

[event_patterns.stun_shadow_valley]
pattern = "Just as you think the falling will never end, you crash through an ethereal barrier"
event_type = "stun"
action = "set"
duration = 16
duration_multiplier = 1.0
enabled = true


# ------------------------------------------------------------
# LAYOUT MAPPINGS
# ------------------------------------------------------------
# Automatically switch layouts based on terminal size.
# Useful for responsive layouts on resize.
#
# Example:
# [[layout_mappings]]
# min_width = 80
# min_height = 24
# max_width = 120
# max_height = 40
# layout = "compact"
#
# [[layout_mappings]]
# min_width = 121
# min_height = 41
# max_width = 9999
# max_height = 9999
# layout = "fullscreen"

layout_mappings = []
